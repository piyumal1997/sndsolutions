import{r as n,j as e}from"./index-B8Hfydgc.js";import{s as l}from"./supabase-C99NjHl9.js";const O=()=>{const[m,P]=n.useState(null),[d,S]=n.useState(!1),[h,A]=n.useState(""),[p,D]=n.useState(""),[j,I]=n.useState([]),[a,x]=n.useState(null),[i,o]=n.useState({title:"",description:"",type:"residential-solar",date:"",details:""}),[g,b]=n.useState([]),[y,v]=n.useState(!1);n.useEffect(()=>{const{data:t}=l.auth.onAuthStateChange((s,c)=>{P(c?.user||null)});return()=>t.subscription.unsubscribe()},[]),n.useEffect(()=>{m&&u()},[m]);const u=async()=>{const{data:t,error:s}=await l.from("projects").select("*").order("date",{ascending:!1});s?alert("Error fetching: "+s.message):I(t||[])},U=async t=>{t.preventDefault();try{let{error:s}=d?await l.auth.signUp({email:h,password:p}):await l.auth.signInWithPassword({email:h,password:p});if(s)throw s}catch(s){alert("Auth error: "+s.message)}},R=async()=>{await l.auth.signOut()},k=async()=>{if(!g.length)return[];const t=[];for(const s of g){const{data:c,error:r}=await l.storage.from("projects").upload(`${Date.now()}_${s.name}`,s);if(r)throw r;const{data:{publicUrl:f}}=l.storage.from("projects").getPublicUrl(c.path);t.push(f)}return t},L=async t=>{t.preventDefault(),v(!0);try{const s=await k(),c=a?.images||[],r={...i,images:[...c,...s]};a?await l.from("projects").update(r).eq("id",a.id):await l.from("projects").insert(r),u(),w()}catch(s){alert("Error: "+s.message)}finally{v(!1)}},w=()=>{x(null),o({title:"",description:"",type:"residential-solar",date:"",details:""}),b([])},q=t=>{x(t),o({title:t.title,description:t.description,type:t.type,date:t.date,details:t.details}),b([])},F=async t=>{confirm("Delete?")&&(await l.from("projects").delete().eq("id",t),u())},T=async t=>{if(!a||!a.images||!Array.isArray(a.images)){alert("No images available or invalid project data.");return}const s=a.images[t];if(typeof s!="string"||!s.trim()){alert("Invalid image at position "+t);return}if(window.confirm(`Are you sure you want to remove this image?

This action cannot be undone.`))try{const r=s.match(/\/object\/public\/projects\/(.+)/);if(!r||!r[1])throw new Error("Could not extract file path from URL");const f=r[1],{error:N}=await l.storage.from("projects").remove([f]);if(N)throw N;const C=a.images.filter(($,_)=>_!==t),{error:E}=await l.from("projects").update({images:C}).eq("id",a.id);if(E)throw E;u(),x({...a,images:C}),alert("Image removed successfully!")}catch(r){console.error("Remove image error:",r),alert("Failed to remove image: "+(r.message||"Unknown error"))}};return m?e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-12",children:[e.jsx("h1",{className:"text-5xl font-bold",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("p",{className:"text-lg",children:["Logged in: ",m.email]}),e.jsx("button",{onClick:R,className:"bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700",children:"Logout"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-10 mb-16",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-8",children:[a?"Edit":"Add"," Project"]}),e.jsxs("form",{onSubmit:L,className:"grid md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",placeholder:"Title *",value:i.title,onChange:t=>o({...i,title:t.target.value}),required:!0,className:"px-6 py-4 border rounded-lg"}),e.jsxs("select",{value:i.type,onChange:t=>o({...i,type:t.target.value}),className:"px-6 py-4 border rounded-lg",children:[e.jsx("option",{value:"residential-solar",children:"Residential Solar"}),e.jsx("option",{value:"industrial-solar",children:"Industrial Solar"}),e.jsx("option",{value:"automation",children:"Automation"}),e.jsx("option",{value:"engineering",children:"Engineering"})]}),e.jsx("input",{type:"date",value:i.date,onChange:t=>o({...i,date:t.target.value}),className:"px-6 py-4 border rounded-lg"}),e.jsx("textarea",{placeholder:"Description *",value:i.description,onChange:t=>o({...i,description:t.target.value}),required:!0,rows:"4",className:"md:col-span-2 px-6 py-4 border rounded-lg"}),e.jsx("textarea",{placeholder:"Details",value:i.details,onChange:t=>o({...i,details:t.target.value}),rows:"6",className:"md:col-span-2 px-6 py-4 border rounded-lg"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-lg font-medium mb-4",children:"Upload New Images"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:t=>b([...t.target.files]),className:"w-full px-6 py-4 border rounded-lg"}),g.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[g.length," files selected"]})]}),a&&a.images?.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("p",{className:"text-lg font-medium mb-4",children:["Current Images (",a.images.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:a.images.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:"Project",className:"w-full h-32 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>T(s),className:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 hover:bg-red-700",children:"Ã—"})]},s))})]}),e.jsxs("div",{className:"md:col-span-2 flex gap-6",children:[e.jsx("button",{type:"submit",disabled:y,className:"bg-green-600 text-white px-8 py-4 rounded-lg hover:bg-green-700 disabled:opacity-50",children:y?"Uploading...":a?"Update Project":"Add Project"}),a&&e.jsx("button",{type:"button",onClick:w,className:"bg-gray-600 text-white px-8 py-4 rounded-lg hover:bg-gray-700",children:"Cancel"})]})]})]}),e.jsxs("h2",{className:"text-3xl font-bold mb-8",children:["Existing Projects (",j.length,")"]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:j.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600 mb-4 line-clamp-3",children:t.description}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1 mb-6",children:[e.jsxs("p",{children:["Type: ",t.type.replace("-"," ").toUpperCase()]}),e.jsxs("p",{children:["Date: ",t.date]}),e.jsxs("p",{children:["Images: ",t.images?.length||0]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>q(t),className:"flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700",children:"Edit"}),e.jsx("button",{onClick:()=>F(t.id),className:"flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700",children:"Delete"})]})]},t.id))})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("form",{onSubmit:U,className:"bg-white p-10 rounded-xl shadow-2xl w-full max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold text-center mb-8",children:d?"Register Admin":"Admin Login"}),e.jsx("input",{type:"email",placeholder:"Email",value:h,onChange:t=>A(t.target.value),required:!0,className:"w-full px-6 py-4 border rounded-lg mb-4"}),e.jsx("input",{type:"password",placeholder:"Password",value:p,onChange:t=>D(t.target.value),required:!0,className:"w-full px-6 py-4 border rounded-lg mb-4"}),e.jsxs("button",{type:"submit",className:"w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700",children:[" ",d?"Register":"Login"]}),e.jsxs("p",{className:"text-center mt-6",children:[d?"Have account?":"No account?"," ",e.jsxs("button",{type:"button",onClick:()=>S(!d),className:"text-green-600 hover:underline",children:[" ",d?"Login":"Register"]})]})]})})};export{O as default};
